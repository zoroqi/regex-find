# regex-find 設計文檔

本文檔描述了 `regex-find` 工具的當前設計與實現, 這是一個基於終端的交互式正則表達式測試工具.

## 1. 總覽 (Overview)

`regex-find` 是一個使用 Go 語言和 `tview` 庫開發的 TUI (文本用戶界面) 應用. 它提供了一個實時反饋的環境, 用戶可以輸入正則表達式和待匹配的文本, 應用程序會立即高亮所有匹配項, 並在一個專門的視圖中詳細列出所有匹配結果及其捕獲組.

## 2. 核心功能 (Core Features)

- **實時正則匹配**: 在用戶輸入正則表達式或文本時, 實時更新匹配結果.
- **多源文本輸入**: 支持從命令行管道 (`pipe`), 文件 (`-file` 標誌), 系統剪貼板 (`-clipboard` 標誌) 或手動輸入來加載待匹配的文本. 文本加載的優先級為: `pipe > clipboard/file`.
- **四窗格佈局**:清晰地將正則輸入, 文本輸入, 高亮結果和匹配列表分離, 提供直觀的操作體驗.
- **高亮顯示**: 使用交替的背景色 (綠色/藍色) 在原文中清晰地標記出所有匹配的文本段.
- **詳細的匹配列表與統計**:
    - 在 "Matches" 視圖的標題欄中實時顯示匹配總數, 格式為 `Matches(20)`.
    - 逐行展示每一個匹配結果.
    - 縮進展示每個匹配結果下的所有捕獲組 (capture groups).
    - 對特殊字符 (如換行, 製表符) 進行轉義, 確保單行顯示的清晰性.
- **結果導出**:
    - 按下 `Ctrl+E` 快捷鍵可彈出導出對話框.
    - 支持多種導出格式: JSON (全部內容), JSON (指定分組), 以及自定義格式 (如 `$1 $2`).
    - 支持導出到系統剪貼板或指定文件.
    - 提供操作結果反饋 (成功或失敗) 的提示框.
- **程序退出時輸出**: 應用程序正常退出時, 會將最後使用的正則表達式輸出到標準輸出.
- **滾動查看**: "高亮視圖" 和 "匹配列表" 均支持使用方向鍵及 Vim 風格的 `hjkl` 鍵進行內容滾動.
- **幫助對話框**: 提供一個 `F1` 觸發的幫助彈窗, 說明核心操作.
- **焦點切換**: 使用 `Tab` 和 `Shift+Tab` 可以在四個可交互的窗格之間循環切換焦點.

## 3. UI 佈局與組件

應用界面基於 `tview` 的 `Flex` 和 `Pages` 組件構建. 為了支持模態對話框 (Modal) 的疊加顯示, 整個 UI 結構分為兩層 `Pages`:

1.  `modalPages`: 作為頂層根容器, 用於疊加顯示結果提示框 (`result`).
2.  `pages`: 作為 `modalPages` 的主頁面 (`main`), 負責在應用的主要視圖 (如主界面, 幫助, 導出表單) 之間進行切換.

主界面佈局如下:
```
+--------------------------------------------------+
|  regexInput (*tview.InputField)                  |
+--------------------------------------------------+
|  textArea (*tview.TextArea)                      |
+--------------------------------------------------+
|  +-------------------+-------------------------+ |
|  | highlightedView   | matchView               | |
|  | (*tview.TextView) | (*tview.TextView)       | |
|  +-------------------+-------------------------+ |
|  +---------------------------------------------+ |
|  | helpHintView (*tview.TextView)              | |
|  +---------------------------------------------+ |
+--------------------------------------------------+
```

- **導出界面**: `export page` 包含一個 `tview.Form`, 用於收集用戶的導出選項. 該頁面通過 `Flex` 佈局實現居中顯示.
- **結果提示框**: 導出操作完成後, 會在 `modalPages` 上彈出一個臨時的 `result` 頁面, 顯示操作成功或失敗的信息.
