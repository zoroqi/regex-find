---
version: 0.0.7
---

# 2025-12-16

## 目標

- [ ] 特定列導出時需要對轉義符進行轉義
- [ ] 優化幫助文檔
- [ ] 合理拆分函數, 補充測試用例
- [ ] 優化文件結構

## 需求

### 合理拆分函數, 補充測試用例

- 將 `internal/app/app.go` 中非 TUI 的核心邏輯 (如 Regex 匹配, 數據格式化) 抽離出來.
- 將 TUI 的設定 (UI 組件的創建和佈局) 與事件處理邏輯分離.
- 為抽離出的核心邏輯編寫單元測試, 確保其正確性.
- 測試應覆蓋 Regex 匹配的成功/失敗場景, 以及各種導出數據格式的生成邏輯.

### 優化文件結構

這是一個小項目, 即使可預見的未來項目也不會太大, 不需要拆分成多個包, 僅僅保留一個 internal 層級就可以了.
將方法合理拆分成多個文件, 讓代碼更清晰就好了.

- 根據功能將代碼移動到不同的目錄和文件中, 使項目結構更清晰.
- 分離 TUI 佈局, 事件處理, 核心邏輯和主程序入口.

### 特定列導出時需要對轉義符進行轉義

問題: 當前選擇 `Custom format` 方案, 會出現轉義符不轉義, 需要進行調整.

比如: 正則 `- (.*?) (.*)`, 導出的 format 結構是 `$2:$1\n\t$1` 會轉換成 `b:a\n\ta` 但實際上我需要的是:
```
b:a
	a
```

需求:
- 將邏輯進行修正
- 提供相應的測試用例

### 優化幫助文檔

- 更新命令行 (`--help`) 的幫助信息, 提供更清晰的用法說明和示例.
- 豐富應用內 (F1) 的幫助彈窗, 包含所有關鍵的快捷鍵和功能說明.
- 確保 `README.md` 的用法說明與最新功能保持同步.

## 實現過程關鍵點

1.  **優化文件結構**:
    - 遵循用戶的簡化要求, 未創建新的子套件.
    - 將 `internal/app/app.go` 按照職責拆分為四個文件:
        - `app.go`: 核心 `App` 結構體定義和啟動函數.
        - `ui.go`: UI 組件的創建和佈局.
        - `events.go`: 鍵盤事件的監聽與分發.
        - `handlers.go`: 響應事件的具體業務邏輯 (如執行匹配, 處理導出).

2.  **修正轉義字符問題**:
    - 定位到 `internal/app/handlers.go` 中的 `generateExportCustom` 函數.
    - 使用 `strings.NewReplacer` 在處理模板 (`$1`, `$2`) 前, 將用戶輸入的格式化字符串中的 `\n` 和 `\t` 等文本替換為實際的轉義字符.

3.  **補充單元測試**:
    - 創建了 `internal/app/app_test.go` 文件.
    - 針對 `generateExportCustom` 函數編寫了表格驅動測試, 覆蓋了正常替換, 轉義字符處理, 空格式化字符串和無匹配項等多個場景.
    - 執行 `go test ./...` 確保所有測試用例通過, 驗證了修復的正確性.

4.  **優化幫助文檔**:
    - **命令行**: 在 `main.go` 中, 通過自定義 `flag.Usage` 函數, 提供了包含用法示例的幫助信息.
    - **應用內**: 在 `internal/app/ui.go` 的 `createHelpModal` 函數中, 擴充了幫助文本, 增加了對 `Ctrl+E` (導出), `Tab` (焦點切換) 等快捷鍵的說明.

## AI 成本

| Model Usage | Reqs | Input Tokens | Output Tokens |
| --- | --- | --- | --- |
| gemini-2.5-flash-lite | 9 | 28,225 | 7,929 |
| gemini-2.5-pro | 35 | 920,965 | 14,425 |
