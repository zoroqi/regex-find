---
version: "0.0.5"
---

# 2025-12-12

## 目標

- [x] 啓動的時候可以加載文件或從管道中讀取, 作爲默認輸入框中的內容
- [x] 匹配的展示結果要有區別, 將分組內容展示出來
- [x] 現實統計信息
- [x] 幫助對話框

## 需求

### 加載文件或讀取管道

問題: 當前待匹配的內容只能通過手動輸入和粘貼方式來實現, 當待匹配文本過大是一個很麻煩的事情, 所以需要支持更多的文本輸入方式.

需求:

- 可以使用管道來直接讀取上一步的所有結果.
- 在啓動的時候設定一個參數, 用來制定要加載的文件.
- 管道優先級高於文件讀取參數
- 將讀取到的文本作爲 "Text Input" 的默認數據.

### 匹配的展示結果

當前匹配展示結果單一, 不是很好確定具體的內容有哪些

需求:
- 匹配結果之間要有一個空行
- 捕獲的分組信息展示出來

展示效果:
```
0: xxx .... end
    1. group ... end
    2. group ... end
1: yyy .... end
    1. group ... end
    2. group ... end
2: ....
```

### 統計信息

問題: 我只能通過在 Maches 框滾動到最後一行來知道匹配成功的數量, 需要更直觀的展示方式.

需求:
- 在整個界面最下面右側提供匹配的統計信息
- 當前值展示一個匹配總數就可以了.

### 幫助對話框

需要一個簡單的對話框來說明基本操作.

需求:
- `F1` 打開對話框, `Esc` 關閉對話框
- 幫助內容:
    - 針對"高亮展示"和"匹配結果"的操作進行說明
- `F1` 打開幫助的說明在界面最下左側展示, 和統計信息保持水平.

## 限制

- 在 internal 文件實現所有具體的業務邏輯

## 實現過程關鍵點

1.  **命令行與管道輸入處理**:
    *   重構 `main.go` 以支持啓動時的數據加載。利用標準庫 `os` 和 `flag` 實現了靈活的輸入機制。
    *   程序啓動時，會首先通過 `os.Stdin.Stat()` 檢測是否存在管道 (pipe) 輸入。如果存在，則優先讀取管道內容。
    *   若無管道數據，則會檢查是否存在 `-file` 命令行參數，並加載指定文件的內容。
    *   讀取到的初始文本內容被傳遞給 `app.New(initialText)` 構造函數，作爲文本輸入框的默認值。

2.  **UI 佈局與組件擴展**:
    *   **狀態欄 (Status Bar)**: 在主界面底部新增了一個狀態欄 (`tview.Flex`)，用於提供實時信息。該狀態欄左側放置了一個 `helpHintView` (`F1 Help`)，右側放置了 `statsView`，用於動態顯示匹配總數 (`Matches: %d`)。
    *   **幫助對話框 (Help Dialog)**: 爲了實現非阻塞式的幫助彈窗，引入了 `tview.Pages` 作爲根組件，用以管理主界面 (`main`) 和幫助頁面 (`help`) 之間的切換。
        *   幫助對話框本身是一個 `tview.Modal`，通過 `F1` 鍵在全局事件捕獲器 (`SetInputCapture`) 中觸發展示。

3.  **豐富匹配結果展示**:
    *   對核心的 `updateHighlight` 函數進行了功能增強。現在它會執行兩次正則匹配：
        1.  `re.FindAllStringIndex()`: 獲取索引，用於高亮視圖。
        2.  `re.FindAllStringSubmatch()`: 獲取包含捕獲組 (capture groups) 的完整字符串數組，用於結果視圖。
    *   重寫了 `updateMatchView` 函數，使其能夠遍歷 `FindAllStringSubmatch` 返回的嵌套數組。結果展示格式被優化，現在會首先顯示完整的匹配項，然後在新行中縮進展示其下的所有捕-獲分組，並在每個主匹配項之間增加一個空行，提高了可讀性。

4.  **交互與視覺微調**:
    *   **視覺風格統一**: 根據用戶反饋，將正則表達式輸入框 (`regexInput`) 的字段背景色和幫助對話框的背景色均設置爲 `tcell.ColorDefault`，使其背景透明，與終端背景融爲一體，避免了視覺上的突兀感。
    *   **API 限制處理**: 在嘗試實現幫助對話框文本左對齊時，發現 `tview.Modal` 組件的公開 API 不支持直接設置其內部 `TextView` 的對齊方式，直接調用會引發編譯錯誤。爲了確保程序的穩定性，該功能點被標記爲 `cancelled`，並移除了相關代碼，保持了 `tview` 默認的居中對齊。

## AI 成本

| Model Usage | Reqs | Input Tokens| Output Tokens |
| --- | --- | --- | --- |
| gemini-2.5-flash-lite | 8 | 16,270| 660 |
| gemini-2.5-pro | 34 | 936,220| 12,341 |
| gemini-2.5-flash | 22 | 858,477| 5,880 |
