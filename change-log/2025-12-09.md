# 2025-12-09

## 目標

- [x] 調整輸入框編輯邏輯
- [x] 匹配的高亮展示方式

## 需求

### 輸入框編輯邏輯

問題: 當前輸入框是"追加式輸入"模式, 沒有光標來動態調整輸入位置, 需要調整成支持插入的編輯模式.

需求:
- 將 Regular Expression 輸入框調整成可插入編輯模式
- 將 Text 輸入框調整成可以插入編輯模式
- 需要我可以使用鍵盤方向鍵來控制光標來實現隨意位置的插入和刪除

### 匹配的高亮展示方式

問題: 當前展示只是將顏色設定成黃色, 這個展示不夠明顯, 需要提供更突出的展示方式.

需求:
- 將匹配的內容展示使用兩種顏色進行交替展示
- 使用 bash 的背景色來突觸展示匹配的內容
- 背景顏色使用綠色和藍色, 字體顏色使用白色

## 限制

- 在 internal 文件實現所有具體的業務邏輯

## 建議

根據情況合理的拆分文件

## 實現過程關鍵點

1. 問題分析與策略調整： 根據用戶反饋的「Text 輸入框無法實現光標縱向移動和換行」問題，分析發現之前自定義的 editor 和 buffer 實現無法有效支持複雜的多行編輯。決定放棄自定義編輯器，轉而採用 tview.TextArea 組件。
2. UI 重構與組件替換：
    * 移除了 internal/editor 和 internal/buffer 兩個自定義包。
    * 將 App 結構體中的 editor 和 textView 替換為 textArea (用於可編輯文本輸入) 和 resultView (用於顯示高亮結果)。
    * setupUI 函數調整為三欄佈局：regexInput (正則表達式輸入框)、textArea (文本輸入區) 和 resultView (高亮結果顯示區)。
3. 事件處理簡化：
    * 移除了 setupEventHandlers 中所有手動處理文本輸入事件的邏輯，轉而利用 tview.TextArea 內建的多行編輯功能。
    * 為 textArea 和 regexInput 設置了 SetChangedFunc，當內容變化時觸發 updateHighlight。
    * 調整了 cycleFocus 函數以適應新的焦點組件。
4. 高亮邏輯修復： 針對用戶報告的「未匹配部分也會被錯誤高亮」問題，對 updateHighlight 函數進行了徹底重寫。
    * 採用了更簡潔、基於文本片段的邏輯：遍歷所有匹配項，先拼接未匹配的文本片段，然後插入帶有顏色標籤的匹配文本片段，最後拼接剩餘未匹配的文本。
    * 此方法確保了顏色標籤 `[COLOR]` 和 `[-]` 總是正確配對，徹底解決了顏色溢出到未匹配區域的問題。

這些改動使得 Text 輸入框實現了完整的多行編輯功能，並且高亮展示也得到了精確修復。

## AI 成本

| Model Usage | Reqs | Input Tokens | Output Tokens |
| gemini-2.5-flash-lite | 8 | 14,507 | 2,418 |
| gemini-2.5-pro | 44 | 871,031 | 18,069 |
| gemini-2.5-flash | 1 | 31,687 | 497 |
